#t2.midium
Control plane:
#sudo hostname kmaster # change hostname to nodename eg. knode-1 if setting up a node
sudo apt-get update
sudo apt install apt-transport-https curl -y
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update

sudo apt-get install containerd.io
sudo mkdir -p /etc/containerd
sudo containerd config default | sudo tee /etc/containerd/config.toml
sudo sed -i '125s/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml
#sudo vi /etc/containerd/config.toml     #set SystemdCgroup = true     on line 125  (:se nu)
sudo systemctl restart containerd

curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add
sudo apt-add-repository "deb http://apt.kubernetes.io/ kubernetes-xenial main"   #modify this line to take the enter input automatically
sudo apt install kubeadm kubelet kubectl kubernetes-cni -y
sudo swapoff -a
sudo modprobe br_netfilter
sudo sysctl -w net.ipv4.ip_forward=1
======================================================
only execute on master:
sudo kubeadm init --pod-network-cidr=10.244.0.0/16

mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
   
kubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/v0.20.2/Documentation/kube-flannel.yml
kubectl get pods --all-namespaces
kubectl get nodes




Execute on Worker Nodes:
sudo apt-get update
sudo apt install apt-transport-https curl -y
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update

sudo apt-get install containerd.io
sudo mkdir -p /etc/containerd
sudo containerd config default | sudo tee /etc/containerd/config.toml
sudo sed -i '125s/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml
#sudo vi /etc/containerd/config.toml     #set SystemdCgroup = true     on line 125  (:se nu)
sudo systemctl restart containerd

curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add
sudo apt-add-repository "deb http://apt.kubernetes.io/ kubernetes-xenial main"   #modify this line to take the enter input automatically
sudo apt install kubeadm kubelet kubectl kubernetes-cni -y
sudo swapoff -a
sudo modprobe br_netfilter
sudo sysctl -w net.ipv4.ip_forward=1
sudo kubeadm join 172.31.84.145:6443 --token 6sohmf.ia1svlq91akdec1j \
        --discovery-token-ca-cert-hash sha256:04de90b291da3c39b21317d8b2a2171fd15f74544289e0e8f8a8e20181ed5e7f

